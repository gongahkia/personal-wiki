<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="Wiki Note: Web Assembly - Gabriel Ong">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../style.css">
  <link rel="preload" href="https://res.hajimehoshi.com/fonts/SuisseIntl-Regular-WebXL.woff2" as="font" crossorigin="anonymous">
  <link rel="preload" href="https://res.hajimehoshi.com/fonts/SuisseIntlMono-Regular-WebXL.woff2" as="font" crossorigin="anonymous">
  <style>
    .thin-space:after{content:"\2006"}
    pre {
      overflow-x: auto;
      max-width: 100%;
    }
  </style>
  <script src="../script.js" defer></script>
  <title>GABRIEL ONG</title>
  <link rel="shortcut icon" href="../asset/blob.ico" type="image/x-icon">
</head>
<body>
  <div id="click-container"></div>
  <input type="button" id="dark-mode">
  <label for="dark-mode">
    <img id="infinityButton" src="../asset/roller.png" height="24" width="24"/>
  </label>

  <main>
    <article class="overallArticleTags">

      <section class="note-header">
        <h2>Web Assembly</h2>

        <dl>
          <dt>File size</dt>
          <dd>20.3KB</dd>

          <dt>Lines of code</dt>
          <dd>287</dd>
        </dl>
      </section>

      <section class="note-content">
        <h1><code>Web Assembly</code></h1>
<p>Binary instruction format enabling high-performance code across many browser platforms. </p>
<h2>Comments</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- COMMENT -----</span>

<span class="c1">;; this is a single-line comment </span>

<span class="c1">;; there is no built-in implementation </span>
<span class="c1">;; for multi-line comments in web assembly</span>
<span class="c1">;; but the same effect can be achieved as seen</span>
<span class="c1">;; here</span>
</code></pre></div>

<h2>Quickstart</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- QUICKSTART -----</span>
    <span class="c1">;; designed to provide a portable compilation target for web browsers, with increasing adoption by modern browser engines</span>
    <span class="c1">;; note that web assembly has multiple representative formats with their own file extensions</span>
        <span class="c1">;; .wasm =&gt; web assembly binary format, used for direct execution by web assembly engines and for transmission over networks</span>
        <span class="c1">;; .wat =&gt; web assembly text format, transcription of the .wasm format into text, closely mimicking .wasm&#39;s semantics</span>
        <span class="c1">;; .wast =&gt; superset of .wat, providing a further abstracted higher-level textual representation of web assembly code (covered in this document)</span>

<span class="c1">;; --- SYNTAX OVERVIEW ---</span>
    <span class="c1">;; export =&gt; specifies the name for which a given entity (such as a function, memory, table, global) is exported by, under which it can then be accessed as a module in JavaScript or via other web assembly modules</span>
    <span class="c1">;; module =&gt; imports standard library and user-defined modules into the local scope of the present file, including their corresponding functionality </span>
    <span class="c1">;; local =&gt; defines local variables with a specified name for use within a locally scoped variable, often used within functions, whose values can be reassigned after initial assignment</span>
    <span class="c1">;; global =&gt; defines global variable with a specified name for use within the global scope of the program, whose values can be reassigned after initial assignment</span>
    <span class="c1">;; .set =&gt; assigns a value to a previously defined variable or global</span>
    <span class="c1">;; .get =&gt; retrieves a value from a previously defined and assigned variable or global</span>
    <span class="c1">;; .const =&gt; defines constants whose value cannot be reassigned after initial assignment</span>
    <span class="c1">;; mut =&gt; specifies a given local or global variable whose value can be reassigned after initial declaration</span>
    <span class="c1">;; $ =&gt; prefixes all variable and constant names, similar to PHP&#39;s variable declaration</span>

<span class="c1">;; --- PRINTING ---</span>
    <span class="c1">;; web assembly does not have direct printing capabilities to the stdout as in other conventional programming languages</span>
    <span class="c1">;; instead, web assembly modules interact directly with their host environments such as web browsers or servers</span>
    <span class="err">output</span> <span class="err">is</span> <span class="err">handled</span> <span class="err">via</span> <span class="err">host</span> <span class="err">environments</span> <span class="err">such</span> <span class="err">as</span> <span class="err">JavaScript</span>
</code></pre></div>

<h2>Types</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- TYPE -----</span>
    <span class="c1">;; i32 =&gt; 32-bit signed integer</span>
    <span class="c1">;; i64 =&gt; 64-bit signed integer</span>
    <span class="c1">;; f32 =&gt; 32-bit single-precision floating-point number</span>
    <span class="c1">;; f64 =&gt; 64-bit double-precision floating-point number</span>
    <span class="c1">;; memory =&gt; stores raw bytes in linear memory, defined with the initial and maximum allocated size in bytes</span>
</code></pre></div>

<h2>Operators</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- OPERATOR -----</span>

<span class="c1">;; --- ARITHMETIC OPERATORS ---</span>

<span class="err">.add</span> <span class="c1">;; addition</span>
<span class="err">.sub</span> <span class="c1">;; subtraction</span>
<span class="err">.mul</span> <span class="c1">;; multiply</span>
<span class="err">.div</span> <span class="c1">;; unsigned division </span>
<span class="err">.div_s</span> <span class="c1">;; signed division </span>
<span class="err">.rem</span> <span class="c1">;; unsigned modulo</span>
<span class="err">.rem_s</span> <span class="c1">;; signed modulo</span>

<span class="c1">;; --- COMPARISON OPERATORS ---</span>

<span class="err">.eq</span> <span class="c1">;; complete equality check for both value and type</span>
<span class="err">.ne</span> <span class="c1">;; complete inequality check for both value and type</span>
<span class="err">.lt</span> <span class="c1">;; less than for unsigned comparisons</span>
<span class="err">.lt_s</span> <span class="c1">;; less than for signed comparisons</span>
<span class="err">.le</span> <span class="c1">;; less than or equal for unsigned comparisons</span>
<span class="err">.le_s</span> <span class="c1">;; less than or equal for signed comparisons</span>
<span class="err">.gt</span> <span class="c1">;; greater than for unsigned comparisons</span>
<span class="err">.gt_s</span> <span class="c1">;; greater than for signed comparisons</span>
<span class="err">.ge</span> <span class="c1">;; greater than or equal for unsigned comparisons</span>
<span class="err">.ge_s</span> <span class="c1">;; greater than or equal for signed comparisons</span>

<span class="c1">;; --- BITWISE (LOGICAL) OPERATORS ---</span>

<span class="err">.and</span> <span class="c1">;; bitwise and</span>
<span class="err">.or</span> <span class="c1">;; bitwise or</span>
<span class="err">.xor</span> <span class="c1">;; bitwise xor</span>
<span class="err">.eqz</span> <span class="c1">;; bitwise not (wherein eqz checks if the specified value is equal to zero)</span>
</code></pre></div>

<h2>Control structures</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- CONTROL STRUCTURE -----</span>

<span class="c1">;; --- CONDITIONALS ---</span>

<span class="c1">;; IF THEN ELSE </span>
    <span class="c1">;; note that web assembly does not provide a elseif construct as in other languages</span>
    <span class="c1">;; instead, the same effect can be achieved with nested if else loops as seen below</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.eq</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">))</span> 
<span class="p">(</span><span class="k">then</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">)</span> 
<span class="p">)</span>
<span class="p">(</span><span class="k">else</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)</span> 
<span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
<span class="p">(</span><span class="nb">i32.eq</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">))</span> 
<span class="p">(</span><span class="k">then</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">)</span> 
<span class="p">)</span>
<span class="p">(</span><span class="k">else</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.eq</span> <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">))</span> 
    <span class="p">(</span><span class="k">then</span>
        <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="p">)</span>
    <span class="p">(</span><span class="k">else</span>
        <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="p">)</span>

<span class="c1">;; --- LOOPS ---</span>
    <span class="c1">;; note that web assembly does not provide default for, foreach and while loop constructs as in other programming languages</span>
    <span class="c1">;; instead, these higher-level loops can be created and user-defined using the loop keyword</span>
    <span class="c1">;; loop =&gt; specifies the beginning of a loop construct, the equivalent of the loop keyword construct in Rust</span>
    <span class="c1">;; br &lt;labelName&gt; =&gt; branch, used to unconditionally jump to the specified label within the current function or codeblock</span>
    <span class="c1">;; br_if &lt;labelName&gt; (&lt;specifiedPredicateCondition&gt;) =&gt; branch if, used to indicate a conditional jump to the specified label within the current function or codeblock if the specified predicate condition is fulfilled</span>
    <span class="c1">;; nop =&gt; no operation, used as a placeholder and the equivalent of pass in other programming languages like Python</span>

<span class="p">(</span><span class="k">loop</span> <span class="nv">$loopLabel</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$counter</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">i32.eqz</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">br_if</span> <span class="nv">$loopEnd</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">local.set</span> <span class="nv">$counter</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">br</span> <span class="nv">$loopLabel</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">nop</span><span class="p">)</span> 
<span class="p">)</span>
<span class="p">(</span><span class="nb">local.get</span> <span class="nv">$result</span><span class="p">)</span> 

<span class="c1">;; USER-DEFINED FOR LOOP</span>

<span class="p">(</span><span class="k">local</span> <span class="nv">$i</span> <span class="kt">i32</span><span class="p">)</span> 
<span class="p">(</span><span class="nb">local.set</span> <span class="nv">$i</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">))</span> 
<span class="p">(</span><span class="k">loop</span> <span class="nv">$loopLabel</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$n</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">i32.lt_s</span><span class="p">)</span> 
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="k">then</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">call</span> <span class="nv">$printInt</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">i32.add</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">local.set</span> <span class="nv">$i</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">br</span> <span class="nv">$loopLabel</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="k">else</span>
            <span class="p">(</span><span class="nb">nop</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1">;; USER-DEFINED WHILE LOOP</span>

<span class="p">(</span><span class="k">local</span> <span class="nv">$i</span> <span class="kt">i32</span><span class="p">)</span> 
<span class="p">(</span><span class="nb">local.set</span> <span class="nv">$i</span> <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">0</span><span class="p">))</span> 
<span class="p">(</span><span class="k">loop</span> <span class="nv">$loopLabel</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$n</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">i32.lt_s</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">br_if</span> <span class="nv">$loopEnd</span><span class="p">)</span> 
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">call</span> <span class="nv">$printInt</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$i</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.const</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">i32.add</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">local.set</span> <span class="nv">$i</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">br</span> <span class="nv">$loopLabel</span><span class="p">)</span>
<span class="p">)</span>
<span class="p">(</span><span class="k">local</span> <span class="nv">$loopEnd</span><span class="p">)</span>
</code></pre></div>

<h2>Functions</h2>
<div class="codehilite"><pre><span></span><code><span class="c1">;; ----- FUNCTION -----</span>
    <span class="c1">;; func =&gt; declares a named function and specifies the function body definition within a web assembly module</span>
    <span class="c1">;; param =&gt; specifies the input parameters and their datatype used within a function definition</span>
    <span class="c1">;; result =&gt; specifies the return datatype of a function definition</span>
    <span class="c1">;; call =&gt; calls the specified previously declared named function</span>

<span class="p">(</span><span class="k">module</span>
    <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">export</span> <span class="s2">&quot;add&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="k">param</span> <span class="nv">$a</span> <span class="kt">i32</span><span class="p">)</span> 
        <span class="p">(</span><span class="k">param</span> <span class="nv">$b</span> <span class="kt">i32</span><span class="p">)</span> 
        <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span> 
        <span class="p">(</span><span class="nb">i32.add</span> 
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$b</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">module</span>
    <span class="p">(</span><span class="k">func</span> <span class="nv">$add</span>
        <span class="p">(</span><span class="k">param</span> <span class="nv">$a</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="k">param</span> <span class="nv">$b</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">i32.add</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$b</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="k">func</span> <span class="p">(</span><span class="k">export</span> <span class="s2">&quot;add&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="k">param</span> <span class="nv">$a</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="k">param</span> <span class="nv">$b</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="k">result</span> <span class="kt">i32</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">call</span> <span class="nv">$add</span> 
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$a</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">local.get</span> <span class="nv">$b</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>

<h2>More on</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly/JavaScript_interface/Table">tables in web assembly</a></li>
<li><a href="https://docs.wasmtime.dev/c-api/annotated.html">c data structures in web assembly</a></li>
<li><a href="https://webassembly.org/">webassembly.org</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/WebAssembly">web assembly documentation</a></li>
<li><a href="https://learnxinyminutes.com/docs/wasm/">learn web assembly in y minutes</a></li>
</ul>
      </section>

    </article>

    <footer>
      <p>© 2023-<span id="current-year"></span> Gabriel Ong. All rights reserved.</p>
    </footer>
  </main>

  <div class="wrapper"></div>
</body>
</html>
